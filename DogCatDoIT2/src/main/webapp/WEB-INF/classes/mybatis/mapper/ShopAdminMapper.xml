<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop">

	<select id="dataCount" resultType="Integer">
		SELECT COUNT(*)
		FROM item
		where enabled='1'
	</select>
	<select id="dataCountDogCat" parameterType="Integer"
		resultType="Integer">
		SELECT COUNT(*)
		FROM item i join itemcategory c on
		i.itemcategoryid=c.itemcategoryid
		where c.parentNum=#{num} and i.enabled='1'

	</select>
	<insert id="insertItem"
		parameterType="com.pet.app.shopping.Item">
		insert into item(itemId, itemCategoryId, shopStoreId,
		itemName,
		itemOriginalPrice, itemSalePrice,
		discountRate,
		registered, saveFileName, des, enabled, manufacturer,content)
		values
		(item_seq.NEXTVAL,#{itemCategoryId},#{shopStoreId},#{itemName},
		#{itemOriginalPrice}, #{itemSalePrice}, #{discountRate}, 
		SYSDATE, #{saveFileName}, #{des}, #{enabled},
		#{manufacturer},#{content})

	</insert>
	
	<delete id="deleteItem" parameterType="long">
	update item set enabled='0', saveFileName='' where itemId=#{num}
	</delete>
	
	<update id="updateItem" parameterType="com.pet.app.shopping.Item">
	update item set itemcategoryId=#{itemCategoryId},shopStoreId=#{shopStoreId},itemName=#{itemName}, itemOriginalPrice=#{itemOriginalPrice},
	itemSalePrice=#{itemSalePrice}, discountRate=#{discountRate}, saveFileName=#{saveFileName}, des=#{des}, content=#{content},
	manufacturer=#{manufacturer}
	where itemId=#{itemId}
	</update> 
	
	<insert id="insertOption" parameterType="map">
		insert into itemoption(optionId, itemid, optionname)
		values(itemoption_seq.NEXTVAL, #{num}, #{name})

	</insert>
	
	<select id="selectOptions" parameterType="long"
		resultType="com.pet.app.shopping.ItemOption">
		select optionId, itemid, optionname from itemoption where itemid=#{num}
	</select>
	
	<select id="selectdetailOptions" parameterType="long"
		resultType="com.pet.app.shopping.DetailOption">
		select detailId, itemoptionId, stock, detailname from detailitemoption where
		itemoptionid=#{num}
	</select>
	
	<select id="findbydetailOptionid" parameterType="long"
		resultType="com.pet.app.shopping.DetailOption">
		select detailId, itemoptionId, stock, detailname, optionname
		 from detailitemoption d join itemoption o on d.itemoptionid=o.optionid
		 where
		detailId=#{num}
	</select>
	
	<insert id="insertdetailOptions" parameterType="map">
	insert into detailitemoption(detailId,itemoptionid,stock,detailname) values(itemdetailoption_seq.NEXTVAL, #{optionNum}, #{stock}, #{name})
	</insert>
	
	<select id="selectAllOptions" parameterType="long" resultType="com.pet.app.shopping.DetailOption">
	select detailId, itemoptionId, stock, detailName, optionname
	from detailitemoption d join itemoption o on d.itemoptionid=o.optionid
	where o.itemid=#{num} order by itemoptionId
	</select>
	
	
	<select id="selectItemCategory"
		resultType="com.pet.app.shopping.ItemCategory">
		select ItemCategoryId,ItemCategoryName,parentNum from
		ItemCategory
		order by parentNum
	</select>

	<select id="findItemCategory" parameterType="long"
		resultType="com.pet.app.shopping.ItemCategory">
		select ItemCategoryId,ItemCategoryName,parentNum from
		ItemCategory
		where ItemCategoryId=${id}
	</select>

	<select id="findItemByItemOption" parameterType="long" resultType="com.pet.app.shopping.Item">
	select i.itemId, itemCategoryId, shopStoreId,
		itemName,
		itemOriginalPrice, itemSalePrice,
		discountRate,
		registered, saveFileName, des, enabled, manufacturer,content
		from item i join itemoption o on i.itemid=o.itemid 
		join detailitemoption d on o.optionId=d.itemoptionId
		where d.detailId=#{num}
	</select>

	<select id="selectShopStore"
		resultType="com.pet.app.shopping.ShopStore">
		select
		shopStoreId,shopStoreName,shopStoreTel,shopStoreAddress1,shopStoreAddress2,enabled
		from shopStore where enabled='1'
	</select>
	
	<select id="findByShopStoreId"
		resultType="com.pet.app.shopping.ShopStore">
		select
		shopStoreId,shopStoreName,shopStoreTel,shopStoreAddress1,shopStoreAddress2,enabled
		from shopStore where shopStoreId=#{num}
	</select>

	<select id="selectOnSale" resultType="com.pet.app.shopping.Item">
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,
		des,content,enabled,manufacturer
		from(
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,des,content,enabled,manufacturer
		from item
		where discountRate>0 and enabled='1'
		order by discountRate
		DESC)
		where rowNum &lt;=5
	</select>

	<select id="selectRecentItem"
		resultType="com.pet.app.shopping.Item">
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,
		des,content,enabled,manufacturer
		from(
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,
		des,content,enabled,manufacturer
		from item where enabled='1'
		order by
		registered DESC)
		where rowNum &lt;=8
	</select>

	<select id="isDogOrCat" parameterType="long" resultType="long">
		select
		c.parentNum
		from item i join itemCategory c on
		i.itemcategoryId=c.itemcategoryId
		where enabled='1' and i.itemId=#{id}
	</select>

	<!--관리자 페이지에서 보여줄 상품 리스트 -->
	<select id="selectItemList" parameterType="map"
		resultType="com.pet.app.shopping.Item">
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,
		des,content,enabled,manufacturer
		from item
		where enabled='1'
		ORDER BY
		registered DESC
		OFFSET #{offset} ROWS FETCH FIRST
		#{rows} ROWS ONLY
	</select>

	<!-- 사용자 입장에서 볼 카테고리별 상품리스트 -->
	<select id="selectCategoryItemList" parameterType="Integer"
		resultType="com.pet.app.shopping.Item">
		select
		itemId,i.itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,
		registered,saveFilename,
		des,content,enabled,manufacturer
		from item i
		join itemcategory c on
		i.itemcategoryId=c.itemcategoryId
		where enabled='1' and
		c.parentNum=#{num}
		ORDER BY registered DESC

	</select>

	<select id="readItem" parameterType="long"
		resultType="com.pet.app.shopping.Item">
		select
		itemId,itemCategoryId,shopStoreId,itemName,itemOriginalPrice,
		itemSalePrice,discountRate,registered,saveFilename,
		des,content,enabled,manufacturer
		from item
		where enabled='1' and
		itemId=#{num}
	</select>
	
	<insert id="insertShopStore" parameterType="com.pet.app.shopping.ShopStore">
	insert into shopstore(shopStoreId,shopStoreName,shopStoreTel,zip,shopStoreAddress1,shopStoreAddress2,enabled) 
	values(shopStore_seq.NEXTVAL,#{shopStoreName},#{shopStoreTel},#{zip}, #{shopStoreAddress1}, #{shopStoreAddress2},#{enabled}) 
	</insert>
	
	
	<select id="selectAllShopStore" resultType="com.pet.app.shopping.ShopStore">
	select shopStoreId,shopStoreName,shopStoreTel,zip,shopStoreAddress1,shopStoreAddress2,enabled
	 from shopStore 
	 order by shopStoreId
	</select>
</mapper>